define(["jquery","util","cookie"],function(i,t){({timer:null,isSend:!1,result:!1,form1:null,getMsgBtn:i("#user-msgcode-btn"),yzmBtn:i("#yzmBtn"),getMsgCode:function(){var t=this,s=60,e=!!this.form1.check("userTel")&&i("#userTel").val(),n=!!this.form1.check("userCode")&&i("#userCode").val();!this.isSend&&e&&n&&i.ajax({type:"POST",url:"/sms/send_auth_code",contentType:"application/json;charset=utf-8",data:JSON.stringify({mobile:e,captcha:n,sms_type:2,user_type:2}),beforeSend:function(){t.isSend=!0},success:function(e){0===e.code?(t.isSend=!1,clearInterval(t.timer),t.getMsgBtn.addClass("disabled"),t.getMsgBtn.html("重新获取("+s+"s)"),t.timer=setInterval(function(){0<--s?t.getMsgBtn.html("重新获取("+s+"s)"):(t.getMsgBtn.html("重新获取").removeClass("disabled"),clearInterval(t.timer))},1e3)):t.form1.showTip("userTel",e.msg)},complete:function(){t.isSend=!1}})},toNext:function(){var e=this,t=this.form1.formCheck();!this.isSend&&t&&(t.user_type=2,t.sms_type=2,i.ajax({type:"POST",url:"/reset_password/valid_mobile",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),beforeSend:function(){e.isSend=!0},success:function(e){0===e.code?(i.cookie("reset_token",e.data.reset_token,{expires:1}),window.location.href="/user/reset"):119===e.code?i("#codeTip").text(e.msg).stop().fadeIn():102===e.code&&i("#msgTip").text(e.msg).stop().fadeIn()},complete:function(){e.isSend=!1}}))},init:function(){var e=this;this.form1=(new t.Validate).init({form:i("#formForget")}),this.getMsgBtn.on("click",function(){i(this).hasClass("disabled")||e.getMsgCode()}),i("#gonext").click(function(){e.toNext()}),i("#userTel").on("input",function(){i(this).val(i(this).val().replace(/\D/g,""))}),this.yzmBtn.on("click",function(){i(this).attr("src","//member.tyfund.com/captcha/captcha.jpg?t="+(new Date).getTime())})}}).init()});