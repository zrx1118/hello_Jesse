define(["jquery","util","cookie","flatpickr"],function(n,e){({timer:null,isSend:!1,isRemember:!1,isAgreen:!1,form1:null,verifyDate:"",$verifyRmb:n("#verifyRmb"),$verifyCode:document.getElementById("verifyCode"),$agreenPro:n("#agreenPro"),getMsgBtn:n("#getMsgBtn"),getMsgCode:function(){var i=this,t=60,e=this.form1.check("agentTel")?n("#agentTel").val():"";!this.isSend&&e&&n.ajax({type:"POST",url:"/sms/send_auth_code",contentType:"application/json;charset=utf-8",data:JSON.stringify({user_type:"2",mobile:e,sms_type:1}),beforeSend:function(){i.isSend=!0},success:function(e){0===e.code?(i.isSend=!1,clearInterval(i.timer),i.getMsgBtn.addClass("disabled"),i.getMsgBtn.html("重新获取("+t+"s)"),i.timer=setInterval(function(){0<--t?i.getMsgBtn.html("重新获取("+t+"s)"):(i.getMsgBtn.html("重新获取").removeClass("disabled"),clearInterval(i.timer))},1e3)):i.form1.showTip("agentTel",e.msg)},complete:function(){i.isSend=!1}})},gonext:function(){var i=this,e=this.form1.formCheck();!this.isSend&&e&&(this.isRemember||e.valid_time?(e.long_time_valid=this.isRemember?1:0,this.isAgreen?n.ajax({type:"POST",url:"/register/do",contentType:"application/json;charset=utf-8",data:JSON.stringify(e),beforeSend:function(){this.isSend=!0},success:function(e){switch(e.code){case 0:window.location.href="/user/register-info";break;case 103:i.form1.showTip("agentTel",e.msg);break;case 102:i.form1.showTip("msgCode",e.msg);break;case 904:i.form1.showTip("idNumber",e.msg);break;default:window.location.href="/500"}},complete:function(){this.isSend=!1}}):n("#vf-tip").html("协议未勾选").fadeIn(200)):n("#validTip").html("证件有效期不能为空").fadeIn(200))},verifyRmb:function(){this.isRemember=!this.isRemember,this.isRemember?(this.$verifyRmb.addClass("check"),n("#verifyCode").attr("disabled",!0)):(this.$verifyRmb.removeClass("check"),n("#verifyCode").attr("disabled",!1))},agreenPro:function(){this.isAgreen=!this.isAgreen,this.isAgreen?(this.$agreenPro.addClass("check"),n("#vf-tip").html("").fadeOut(200)):this.$agreenPro.removeClass("check")},init:function(){var s=this;this.form1=(new e.Validate).init({form:n("#formRegister")}),!this.isRemember&&this.$verifyCode.flatpickr({onChange:function(e,i,t){s.verifyDate=i,s.form1._valid(2,!0,!1)}}),this.$verifyRmb.on("click",function(){s.verifyRmb()}),this.$agreenPro.on("click",function(){s.agreenPro()}),n("#agentTel").on("input",function(){n(this).val(n(this).val().replace(/\D/g,""))}),this.getMsgBtn.on("click",function(){n(this).hasClass("disabled")||s.getMsgCode()}),n("#gonext").on("click",function(){s.gonext()})}}).init()});